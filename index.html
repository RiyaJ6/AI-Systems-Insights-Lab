<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Systems Insights Lab</title>
    <style>
        /* ===== NEON CYBERPUNK VARIABLES ===== */
        :root {
            --neon-pink: #ff00ff;
            --neon-cyan: #00f5ff;
            --neon-purple: #9d00ff;
            --dark-bg: #0a0a0a;
            --card-bg: rgba(20, 20, 40, 0.4);
            --glass-border: rgba(0, 245, 255, 0.3);
            --glow-pink: 0 0 20px rgba(255, 0, 255, 0.6);
            --glow-cyan: 0 0 20px rgba(0, 245, 255, 0.6);
            --gradient-1: linear-gradient(135deg, #ff00cc 0%, #333399 100%);
            --gradient-2: linear-gradient(135deg, #00f5ff 0%, #9d00ff 100%);
            --gradient-3: linear-gradient(90deg, #ff00ff, #00f5ff, #9d00ff);
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== EPIC RESET ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark-bg);
            color: white;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* ===== PARTICLE CANVAS BACKGROUND ===== */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        /* ===== NAVIGATION BAR ===== */
        .nav-bar {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1.2rem 3rem;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.7);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.8rem;
            font-weight: 900;
            background: var(--gradient-3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            animation: gradientShift 3s infinite;
        }

        .logo svg {
            width: 40px;
            height: 40px;
            filter: drop-shadow(var(--glow-pink));
        }

        .nav-tabs {
            display: flex;
            gap: 0.8rem;
        }

        .nav-tab {
            padding: 0.8rem 1.8rem;
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            color: var(--neon-cyan);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-transform: uppercase;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: var(--glow-cyan);
            border-color: var(--neon-cyan);
        }

        .nav-tab.active {
            background: var(--gradient-1);
            border-color: var(--neon-pink);
            box-shadow: var(--glow-pink);
            color: white;
        }

        /* ===== HERO SECTION ===== */
        .hero {
            text-align: center;
            padding: 10rem 2rem 4rem;
        }

        .hero h1 {
            font-size: 5rem;
            font-weight: 900;
            margin-bottom: 1rem;
            background: var(--gradient-3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% auto;
            animation: gradientShift 4s ease infinite, float 6s ease infinite;
        }

        .hero p {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            max-width: 700px;
            margin: 0 auto;
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== 3D CARD SYSTEM ===== */
        .neon-card {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            transition: var(--transition-smooth);
        }

        .neon-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-3);
            border-radius: 24px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.4s;
            animation: gradientShift 4s infinite;
        }

        .neon-card:hover::before {
            opacity: 0.5;
        }

        .neon-card:hover {
            transform: rotateX(5deg) rotateY(5deg) translateY(-10px);
            box-shadow: var(--glow-pink);
            border-color: var(--neon-pink);
        }

        .split-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2.5rem;
            margin-bottom: 3rem;
        }

        /* ===== INPUT SECTION ===== */
        textarea {
            width: 100%;
            min-height: 350px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            color: white;
            font-size: 1.1rem;
            font-family: inherit;
            resize: vertical;
            transition: var(--transition-smooth);
        }

        textarea:focus {
            outline: none;
            border-color: var(--neon-pink);
            box-shadow: var(--glow-pink);
        }

        /* ===== METRICS CARDS ===== */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .metric-card {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.4), rgba(50, 50, 100, 0.2));
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: var(--transition-smooth);
        }

        .metric-card:hover {
            transform: scale(1.08) rotateX(5deg);
            box-shadow: var(--glow-cyan);
            border-color: var(--neon-cyan);
        }

        .metric-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            filter: drop-shadow(var(--glow-pink));
        }

        .metric-value {
            font-size: 3.5rem;
            font-weight: 900;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 1.5s infinite;
        }

        .metric-label {
            color: var(--neon-cyan);
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        .metric-bar {
            margin-top: 1.5rem;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: var(--gradient-3);
            background-size: 200% auto;
            width: 0%;
            transition: width 1s ease;
            animation: gradientShift 3s infinite;
        }

        /* ===== TOKEN VISUALIZATION ===== */
        .token-container {
            min-height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            align-content: flex-start;
            border: 2px solid var(--glass-border);
        }

        .token-bubble {
            background: var(--gradient-1);
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            animation: bubblePop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .token-bubble::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .token-bubble:hover::before {
            left: 100%;
        }

        .token-bubble:hover {
            transform: scale(1.2) rotate(5deg);
            box-shadow: var(--glow-pink);
        }

        /* ===== ANALYSIS SECTION ===== */
        .analysis-card {
            margin-top: 2rem;
        }

        .analysis-item {
            padding: 1.2rem;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--neon-cyan);
            border-radius: 12px;
            animation: slideInLeft 0.6s ease;
            transition: var(--transition-smooth);
        }

        .analysis-item:hover {
            transform: translateX(10px);
            border-left-color: var(--neon-pink);
        }

        /* ===== BUTTONS ===== */
        .btn-primary {
            padding: 1.2rem 2.5rem;
            background: var(--gradient-1);
            border: none;
            border-radius: 16px;
            color: white;
            font-weight: 900;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: var(--transition-smooth);
            box-shadow: var(--glow-pink);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: var(--glow-cyan);
        }

        /* ===== SIMULATOR ===== */
        .simulator-box {
            min-height: 400px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid var(--glass-border);
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .typing-indicator {
            display: inline-flex;
            gap: 6px;
            margin-left: 1rem;
        }

        .typing-indicator span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--neon-cyan);
            animation: typingDot 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        /* ===== CONTEXT VISUALIZER ===== */
        .context-window {
            height: 120px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 2px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .context-fill {
            height: 100%;
            background: var(--gradient-2);
            width: 0%;
            transition: width 1s ease;
            box-shadow: var(--glow-cyan);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes bubblePop {
            from {
                opacity: 0;
                transform: scale(0.3) rotate(-10deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes typingDot {
            0%, 60%, 100% { transform: scale(0); }
            30% { transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .split-grid {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 3rem;
            }
            
            .nav-tabs {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Particle Background -->
    <canvas id="particleCanvas"></canvas>

    <!-- Navigation -->
    <nav class="nav-bar">
        <div class="logo">
            <svg viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="19" fill="#ff00ff"/>
                <path d="M20 8 L24 18 L34 18 L26 24 L28 36 L20 28 L12 36 L14 24 L6 18 L16 18 Z" fill="#00f5ff"/>
            </svg>
            AI Lab
        </div>
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('analyzer')">Analyzer</div>
            <div class="nav-tab" onclick="switchTab('simulator')">Simulator</div>
            <div class="nav-tab" onclick="switchTab('context')">Context</div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <h1>AI SYSTEMS INSIGHTS LAB</h1>
        <p>Decode. Analyze. Optimize. Dominate.</p>
    </section>

    <!-- Main Content -->
    <main class="container">
        <!-- ANALYZER TAB -->
        <section id="analyzer" class="tab-content active">
            <div class="split-grid">
                <div class="neon-card">
                    <h2 style="color: var(--neon-cyan); font-size: 1.8rem; margin-bottom: 1.5rem;">üìù PROMPT INPUT</h2>
                    <textarea id="promptInput" placeholder="Enter your AI prompt here...&#10;&#10;Example: Write a Python function that calculates Fibonacci numbers using memoization. Explain time complexity."></textarea>
                    
                    <div style="margin-top: 2rem;">
                        <label style="color: var(--neon-pink); font-weight: 700;">AI Model</label>
                        <select id="modelSelect" style="width: 100%; padding: 0.8rem; margin-top: 0.5rem; background: rgba(0,0,0,0.5); border: 2px solid var(--glass-border); border-radius: 12px; color: white; font-size: 1rem;">
                            <option value="gpt-4">GPT-4 Turbo ($10/1M tokens)</option>
                            <option value="gpt-3.5">GPT-3.5 Turbo ($1/1M tokens)</option>
                            <option value="claude">Claude 3.5 Sonnet ($3/1M tokens)</option>
                            <option value="gemini">Gemini 1.5 Pro ($1.5/1M tokens)</option>
                        </select>
                    </div>

                    <div style="margin-top: 1.5rem;">
                        <label style="color: var(--neon-pink); font-weight: 700;">Temperature: <span id="tempValue" style="color: var(--neon-cyan);">0.7</span></label>
                        <input type="range" id="tempSlider" min="0" max="2" step="0.1" value="0.7" style="width: 100%; margin-top: 0.5rem;">
                    </div>
                </div>

                <div>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon">üìè</div>
                            <div class="metric-value" id="charCount">0</div>
                            <div class="metric-label">Characters</div>
                            <div class="metric-bar"><div class="bar-fill" id="charBar"></div></div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üìù</div>
                            <div class="metric-value" id="wordCount">0</div>
                            <div class="metric-label">Words</div>
                            <div class="metric-bar"><div class="bar-fill" id="wordBar"></div></div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üî¢</div>
                            <div class="metric-value" id="tokenCount">0</div>
                            <div class="metric-label">Est. Tokens</div>
                            <div class="metric-bar"><div class="bar-fill" id="tokenBar"></div></div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üí∞</div>
                            <div class="metric-value" id="costEstimate">$0.0000</div>
                            <div class="metric-label">Est. Cost</div>
                            <div class="metric-bar"><div class="bar-fill" id="costBar"></div></div>
                        </div>
                    </div>

                    <div class="neon-card analysis-card">
                        <h3 style="color: var(--neon-pink); font-size: 1.5rem; margin-bottom: 1rem;">üîç PROMPT ANALYSIS</h3>
                        <div id="promptAnalysis">
                            <div style="color: var(--text-secondary);">Enter a prompt for AI optimization insights...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="neon-card" style="margin-top: 2rem;">
                <h3 style="color: var(--neon-cyan); font-size: 1.8rem; margin-bottom: 1rem;">‚ú® TOKEN VISUALIZATION</h3>
                <div id="tokenDisplay" class="token-container">
                    <div class="empty-state">Start typing to see token breakdown...</div>
                </div>
            </div>
        </section>

        <!-- SIMULATOR TAB -->
        <section id="simulator" class="tab-content">
            <div class="split-grid">
                <div class="neon-card">
                    <h2 style="color: var(--neon-pink); margin-bottom: 1.5rem;">‚ö° SIMULATION CONTROLS</h2>
                    <div style="display: flex; flex-direction: column; gap: 2rem;">
                        <div>
                            <label style="color: var(--neon-cyan);">Response Length: <span id="responseLengthValue" style="color: white;">500</span> tokens</label>
                            <input type="range" id="responseLength" min="50" max="4000" step="50" value="500" style="width: 100%; margin-top: 0.5rem;">
                        </div>
                        <div>
                            <label style="color: var(--neon-cyan);">Network Latency: <span id="latencyValue" style="color: white;">100</span>ms</label>
                            <input type="range" id="latency" min="0" max="500" step="10" value="100" style="width: 100%; margin-top: 0.5rem;">
                        </div>
                        <button class="btn-primary" onclick="startSimulation()" style="margin-top: 1rem;">‚ñ∂ START SIMULATION</button>
                    </div>
                </div>

                <div class="neon-card">
                    <h3 style="color: var(--neon-cyan); margin-bottom: 1rem;">üì° STREAMING OUTPUT</h3>
                    <div class="simulator-box" id="simulatorOutput">
                        <em style="color: var(--text-secondary);">Click "Start Simulation" to see AI response streaming...</em>
                    </div>
                    <div id="typingIndicator" class="typing-indicator" style="display: none;">
                        <span></span><span></span><span></span>
                    </div>
                    <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div class="metric-card">
                            <div class="metric-label">Time to First Token</div>
                            <div class="metric-value" id="ttft">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Total Time</div>
                            <div class="metric-value" id="totalTime">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Tokens/Sec</div>
                            <div class="metric-value" id="tps">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CONTEXT TAB -->
        <section id="context" class="tab-content">
            <div class="neon-card">
                <h2 style="color: var(--neon-pink); margin-bottom: 2rem;">üéØ CONTEXT WINDOW VISUALIZER</h2>
                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span>Context: <strong style="color: var(--neon-cyan);">128K</strong> tokens</span>
                        <span id="contextUsed" style="color: var(--neon-pink);">0 / 128,000 (0%)</span>
                    </div>
                    <div class="context-window">
                        <div class="context-fill" id="contextFill"></div>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <button class="btn-primary" onclick="addMessage('user')">+ User Message</button>
                    <button class="btn-primary" onclick="addMessage('assistant')">+ Assistant Reply</button>
                    <button class="btn-primary" onclick="addMessage('system')">+ System</button>
                    <button class="btn-primary" style="background: rgba(255,0,0,0.2);" onclick="clearContext()">Clear All</button>
                </div>
                <div id="messageList" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </section>
    </main>

    <script>
        // ===== PARTICLE SYSTEM =====
        function initParticles() {
            const canvas = document.getElementById('particleCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            const particleCount = 120;

            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.vx = (Math.random() - 0.5) * 0.8;
                    this.vy = (Math.random() - 0.5) * 0.8;
                    this.radius = Math.random() * 2.5 + 0.5;
                    this.opacity = Math.random() * 0.5 + 0.2;
                    this.color = Math.random() > 0.5 ? '#ff00ff' : '#00f5ff';
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
                }

                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = this.opacity;
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            }

            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                requestAnimationFrame(animate);
            }
            animate();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // ===== AI ANALYZER ENGINE =====
        class AIAnalyzer {
            constructor() {
                this.modelCosts = {
                    'gpt-4': 0.01, 'gpt-3.5': 0.001, 'claude': 0.003, 'gemini': 0.0015
                };
            }

            estimateTokens(text) {
                return text.trim() ? Math.ceil(text.length / 4) : 0;
            }

            calculateCost(tokens, model) {
                const cost = (tokens * this.modelCosts[model]) / 1000;
                return cost.toFixed(5);
            }

            analyzePrompt(text) {
                if (!text.trim()) return '<div style="color: var(--text-secondary);">Enter a prompt for AI optimization insights...</div>';
                
                const patterns = {
                    instruction: /\b(write|create|generate|explain|summarize|analyze|calculate)\b/i,
                    code: /\b(code|function|python|javascript|java|api)\b/i,
                    format: /\b(json|table|list|markdown|html)\b/i,
                    constraints: /\b(max|limit|only|exactly)\b/i
                };

                let insights = [];
                if (text.length < 20) insights.push('‚ö†Ô∏è <strong style="color: #ff6666;">Too Short:</strong> Add more context');
                else if (text.length > 2000) insights.push('‚ö†Ô∏è <strong style="color: #ff6666;">Too Long:</strong> Break into smaller prompts');
                else insights.push('‚úÖ <strong style="color: #66ff66;">Optimal Length:</strong> Good size');

                if (patterns.instruction.test(text)) insights.push('‚úÖ <strong style="color: #66ff66;">Clear Instruction:</strong> Action verbs detected');
                if (patterns.code.test(text)) insights.push('üíª <strong style="color: var(--neon-cyan);">Code Prompt:</strong> Specify language & requirements');
                if (patterns.format.test(text)) insights.push('üìã <strong style="color: #66ff66;">Format Specified:</strong> Improves output quality');
                if (patterns.constraints.test(text)) insights.push('üéØ <strong style="color: var(--neon-pink);">Constraints Found:</strong> Good for precision');

                return `<ul style="list-style: none;">${insights.map(i => `<li class="analysis-item">${i}</li>`).join('')}</ul>`;
            }

            visualizeTokens(text) {
                const container = document.getElementById('tokenDisplay');
                if (!text.trim()) {
                    container.innerHTML = '<div class="empty-state">Start typing to see token breakdown...</div>';
                    return;
                }

                const words = text.split(/\s+/).filter(w => w.length > 0);
                container.innerHTML = '';
                words.slice(0, 25).forEach((word, i) => {
                    const bubble = document.createElement('div');
                    bubble.className = 'token-bubble';
                    bubble.textContent = `${i}:${word}`;
                    bubble.onclick = () => burstToken(bubble);
                    container.appendChild(bubble);
                });

                if (words.length > 25) {
                    const more = document.createElement('div');
                    more.textContent = `+${words.length - 25} more...`;
                    more.style.color = 'var(--text-secondary)';
                    more.style.width = '100%';
                    container.appendChild(more);
                }
            }

            updateMetrics() {
                const text = document.getElementById('promptInput').value;
                const model = document.getElementById('modelSelect').value;
                const tokens = this.estimateTokens(text);

                this.animateValue('charCount', text.length);
                this.animateValue('wordCount', text.split(/\s+/).filter(w => w.length > 0).length);
                this.animateValue('tokenCount', tokens);
                document.getElementById('costEstimate').textContent = `$${this.calculateCost(tokens, model)}`;

                document.getElementById('charBar').style.width = `${Math.min(text.length / 20, 100)}%`;
                document.getElementById('wordBar').style.width = `${Math.min(text.split(/\s+/).filter(w => w.length > 0).length / 2, 100)}%`;
                document.getElementById('tokenBar').style.width = `${Math.min(tokens / 2, 100)}%`;
                document.getElementById('costBar').style.width = `${Math.min(parseFloat(this.calculateCost(tokens, model)) * 1000, 100)}%`;

                document.getElementById('promptAnalysis').innerHTML = this.analyzePrompt(text);
                this.visualizeTokens(text);
            }

            animateValue(id, target) {
                const element = document.getElementById(id);
                const start = parseInt(element.textContent) || 0;
                const duration = 800;
                const startTime = performance.now();

                function update(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const value = Math.floor(start + (target - start) * progress);
                    element.textContent = value;
                    if (progress < 1) requestAnimationFrame(update);
                }
                requestAnimationFrame(update);
            }
        }

        // ===== CONTEXT VISUALIZER =====
        class ContextVisualizer {
            constructor() {
                this.maxTokens = 128000;
                this.currentTokens = 0;
                this.messages = [];
            }

            addMessage(type) {
                const tokens = { user: 50, assistant: 150, system: 100 }[type] + Math.floor(Math.random() * 50);
                this.messages.push({ type, tokens: tokens });
                this.currentTokens += tokens;
                this.updateDisplay();
            }

            clearContext() {
                this.messages = [];
                this.currentTokens = 0;
                this.updateDisplay();
            }

            removeMessage(index) {
                this.currentTokens -= this.messages[index].tokens;
                this.messages.splice(index, 1);
                this.updateDisplay();
            }

            updateDisplay() {
                const percentage = (this.currentTokens / this.maxTokens) * 100;
                document.getElementById('contextFill').style.width = `${percentage}%`;
                document.getElementById('contextUsed').textContent = `${this.currentTokens.toLocaleString()} / ${this.maxTokens.toLocaleString()} (${percentage.toFixed(1)}%)`;
                
                const list = document.getElementById('messageList');
                list.innerHTML = this.messages.map((msg, i) => `
                    <div class="analysis-item" style="display: flex; justify-content: space-between; align-items: center;">
                        <span>üìù <strong style="color: var(--neon-cyan);">${msg.type.toUpperCase()}</strong> - ${msg.tokens} tokens</span>
                        <button onclick="contextViz.removeMessage(${i})" style="background: transparent; border: 2px solid #ff6666; color: #ff6666; padding: 0.3rem 0.8rem; border-radius: 8px; cursor: pointer; font-weight: 700;">REMOVE</button>
                    </div>
                `).join('');
            }
        }

        // ===== SIMULATOR =====
        function startSimulation() {
            const length = parseInt(document.getElementById('responseLength').value);
            const latency = parseInt(document.getElementById('latency').value);
            const output = document.getElementById('simulatorOutput');
            const indicator = document.getElementById('typingIndicator');
            
            const responses = [
                "The Fibonacci sequence is a series where each number equals the sum of the two preceding ones. Using memoization optimization, we cache previously computed values in a hash map. This reduces exponential O(2^n) complexity to linear O(n) time with O(n) space. The implementation checks cache existence before recursion, dramatically improving performance for large inputs.",
                "Time complexity analysis reveals dramatic improvements. Naive recursion recalculates identical subproblems repeatedly, causing exponential blowup. Memoization ensures each Fibonacci number computes exactly once. Space complexity remains O(n) for the cache plus call stack depth. For iterative solutions, we achieve O(n) time with O(1) space using two variables.",
                "Implementation considerations include choosing between recursion vs iteration. While memoization optimizes recursion, iterative approaches avoid call stack limits. For production systems, consider matrix exponentiation achieving O(log n) complexity using fast doubling methods. Python's lru_cache decorator automatically handles memoization transparently."
            ];
            
            const text = responses[Math.floor(Math.random() * responses.length)];
            const words = text.split(/\s+/);
            
            output.innerHTML = '';
            indicator.style.display = 'inline-flex';
            
            const startTime = performance.now();
            let firstTokenTime = null;
            let index = 0;

            function stream() {
                if (index === 0) {
                    firstTokenTime = performance.now();
                    document.getElementById('ttft').textContent = `${(firstTokenTime - startTime).toFixed(0)}ms`;
                }
                
                if (index < words.length) {
                    output.innerHTML += (index === 0 ? '' : ' ') + words[index];
                    index++;
                    setTimeout(stream, 20 + Math.random() * 30);
                } else {
                    indicator.style.display = 'none';
                    const endTime = performance.now();
                    const totalTime = endTime - startTime;
                    document.getElementById('totalTime').textContent = `${totalTime.toFixed(0)}ms`;
                    document.getElementById('tps').textContent = `${(length / (totalTime / 1000)).toFixed(1)}`;
                }
            }
            
            setTimeout(stream, latency);
        }

        // ===== TOKEN BURST EFFECT =====
        function burstToken(element) {
            element.style.transform = 'scale(2) rotate(15deg)';
            element.style.opacity = '0';
            element.style.boxShadow = '0 0 40px #ff00ff';
            setTimeout(() => element.remove(), 300);
        }

        // ===== TAB SWITCHING =====
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
        }

        // ===== GLOBAL VARIABLES =====
        let analyzer, contextViz;

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            initParticles();
            analyzer = new AIAnalyzer();
            contextViz = new ContextVisualizer();
            
            document.getElementById('promptInput').addEventListener('input', () => analyzer.updateMetrics());
            document.getElementById('modelSelect').addEventListener('change', () => analyzer.updateMetrics());
            document.getElementById('tempSlider').addEventListener('input', (e) => {
                document.getElementById('tempValue').textContent = e.target.value;
            });
            
            analyzer.updateMetrics();
        });
    </script>
</body>
</html>

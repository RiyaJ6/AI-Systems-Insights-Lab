<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Insights Lab — Epic UI</title>

<!-- Chart.js for charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- PDF.js for PDF text extraction -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-1: #071122;
    --bg-2: #071b2c;
    --card: rgba(255,255,255,0.03);
    --muted: #9fb0c6;
    --accent: #7c3aed;
    --accent-2: #34d399;
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
    --glass-border: rgba(255,255,255,0.05);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent 8%),
                radial-gradient(900px 400px at 90% 85%, rgba(52,211,153,0.06), transparent 6%),
                linear-gradient(180deg,var(--bg-1),var(--bg-2));
    color:#eaf6ff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-y:auto;
  }

  /* layout */
  .wrap { max-width:1180px; margin:28px auto; padding:22px; }
  header.hero{
    display:flex; gap:20px; align-items:center; justify-content:space-between;
    margin-bottom:20px;
  }
  .brand{
    display:flex; gap:16px; align-items:center;
  }

  /* Logo badge */
  .logo {
    width:72px; height:72px; border-radius:18px;
    background: linear-gradient(135deg, rgba(124,58,237,0.18), rgba(52,211,153,0.08));
    display:flex; align-items:center; justify-content:center;
    box-shadow: 0 8px 30px rgba(4,6,12,0.6);
    transform: translateZ(0);
    transition:transform .36s cubic-bezier(.2,.9,.2,1);
  }
  .logo:hover{ transform: translateY(-6px) rotate(-4deg) scale(1.02) }

  .logo svg { filter: drop-shadow(0 6px 18px rgba(124,58,237,0.16)); }

  .title h1{ margin:0; font-size:20px; letter-spacing:-0.2px; }
  .title p{ margin:4px 0 0; color:var(--muted); font-size:13px }

  /* controls */
  .controls { display:flex; gap:10px; align-items:center; }
  .select, .toggle, .btn {
    background:transparent; border:1px solid var(--glass-border); padding:8px 12px; border-radius:10px;
    color:inherit; font-weight:600; font-size:13px; cursor:pointer;
    transition: all .18s ease;
  }
  .select:focus, .toggle:focus, .btn:focus{ outline:none; box-shadow: 0 6px 20px rgba(0,0,0,0.4) }
  .btn.primary{
    background: linear-gradient(90deg,var(--accent), #5b21b6); color:white; border: none; padding:9px 14px;
    box-shadow: 0 8px 30px rgba(92,33,204,0.14), inset 0 -1px 0 rgba(255,255,255,0.03);
  }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted) }

  /* main grid */
  .grid { display:grid; grid-template-columns:360px 1fr; gap:18px; align-items:start; }
  @media (max-width:980px){ .grid { grid-template-columns: 1fr } }

  /* left panel */
  .panel { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:14px; border:1px solid var(--glass-border); box-shadow: 0 6px 40px rgba(2,6,23,0.4); }
  .panel h3 { margin:0 0 6px 0; font-size:15px }
  .muted { color:var(--muted); font-size:13px }

  /* uploader */
  .uploader {
    margin-top:12px; padding:16px; border-radius:12px; border:1px dashed rgba(255,255,255,0.04);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    transition: transform .18s ease, box-shadow .18s ease, border-color .12s ease;
    display:flex; align-items:center; gap:12px; cursor:pointer;
  }
  .uploader:hover { transform:translateY(-4px); box-shadow: 0 12px 40px rgba(2,6,23,0.45) }
  .uploader.dragover { border-color: rgba(124,58,237,0.6); box-shadow: 0 12px 50px rgba(124,58,237,0.08) }

  .upload-graphic { width:64px; height:64px; border-radius:10px; display:flex; align-items:center; justify-content:center; background: rgba(255,255,255,0.02) }
  .upload-graphic svg { width:40px; height:40px; opacity:0.95 }

  .file-info { flex:1 }
  .file-actions { display:flex; gap:8px }

  /* file list */
  .file-list { margin-top:12px; display:flex; flex-direction:column; gap:8px; max-height:220px; overflow:auto; padding-right:6px }
  .file-item { display:flex; gap:10px; align-items:center; padding:8px; border-radius:10px; background: rgba(0,0,0,0.12); border:1px solid rgba(255,255,255,0.02); transition: transform .12s ease }
  .file-item:hover { transform: translateY(-6px) }
  .file-meta { flex:1; display:flex; flex-direction:column }
  .small { font-size:13px; color:var(--muted) }

  /* right panel */
  .dashboard { padding:16px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.008)); border:1px solid var(--glass-border); }
  .kpis { display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap }
  .kpi { padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); min-width:120px; text-align:center }
  .kpi .num { font-size:18px; font-weight:800; color:#fff }

  /* insights grid */
  .insights { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-top:12px }
  .insight-card { padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.02); transition: transform .14s }
  .insight-card:hover { transform: translateY(-6px) }

  /* charts */
  .chart { width:100%; height:260px }

  /* footer */
  footer.pagefoot { margin-top:18px; text-align:center; color:var(--muted); font-size:13px }

  /* animated floating blobs in hero */
  .hero-art { position:relative; width:220px; height:72px; overflow:visible }
  .blob { position:absolute; border-radius:50%; filter: blur(22px); opacity:0.9; transform: translateZ(0) }
  .blob.one { width:120px; height:120px; left:-40px; top:-36px; background: linear-gradient(90deg, rgba(124,58,237,0.4), rgba(52,211,153,0.12)); animation: floaty 6s ease-in-out infinite }
  .blob.two { width:80px; height:80px; right:-10px; top:-10px; background: linear-gradient(90deg, rgba(52,211,153,0.26), rgba(59,130,246,0.06)); animation: floaty 5s ease-in-out infinite reverse }
  @keyframes floaty { 0% { transform: translateY(0) } 50% { transform: translateY(-12px) } 100% { transform: translateY(0) } }

  /* animations for buttons */
  .pulse { animation: pulse 2.6s infinite; }
  @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(124,58,237,0.12) } 70% { box-shadow: 0 0 0 18px rgba(124,58,237,0.02) } 100% { box-shadow: 0 0 0 0 rgba(124,58,237,0.02) } }
</style>
</head>
<body>
  <div class="wrap">
    <!-- HERO / HEADER -->
    <header class="hero">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- stylized AI hexagon logo (SVG) -->
          <svg viewBox="0 0 64 64" width="52" height="52" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#7C3AED"/>
                <stop offset="1" stop-color="#34D399"/>
              </linearGradient>
            </defs>
            <rect x="6" y="6" width="52" height="52" rx="10" fill="url(#g1)"></rect>
            <g transform="translate(10 10)" fill="white" opacity="0.96">
              <path d="M9 4h18v4H9zM9 10h18v4H9zM9 16h18v4H9z" opacity="0.95"></path>
            </g>
          </svg>
        </div>
        <div class="title">
          <h1>AI Insights Lab</h1>
          <p class="muted">Turn documents into instant insights — beautiful, private, and fast.</p>
        </div>
      </div>

      <div class="controls">
        <div class="hero-art" aria-hidden="true">
          <div class="blob one"></div>
          <div class="blob two"></div>
        </div>

        <select id="mode" class="select" title="Mode: Mock or Live">
          <option value="mock">Mock (offline)</option>
          <option value="live">Live (proxy)</option>
        </select>

        <button id="themeBtn" class="toggle" title="Toggle theme">Theme</button>
        <button id="exportBtn" class="btn primary pulse" title="Export report">Export Report</button>
      </div>
    </header>

    <main class="grid">
      <!-- LEFT: Upload / Files -->
      <section class="panel">
        <h3>Upload Files</h3>
        <div class="muted">Drop files here or click the area. Supported: <strong>.txt .csv .pdf</strong> — client-side only.</div>

        <!-- uploader: supports click & drag -->
        <label id="uploader" class="uploader" for="fileInput" tabindex="0">
          <div class="upload-graphic" aria-hidden="true">
            <!-- upload icon -->
            <svg viewBox="0 0 24 24" width="34" height="34" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 5 17 10"></polyline>
              <line x1="12" y1="5" x2="12" y2="19"></line>
            </svg>
          </div>
          <div class="file-info">
            <div style="font-weight:700">Click to select or drag files here</div>
            <div class="small">Max 8 files • Files stay in your browser • No upload to server in Mock mode</div>
          </div>
          <div class="file-actions">
            <div class="small" id="quickCount">0 files</div>
          </div>
        </label>
        <input id="fileInput" type="file" accept=".txt,.csv,.pdf" multiple style="display:none" />

        <div class="file-list" id="fileList" role="list" aria-live="polite"></div>

        <div style="display:flex; gap:8px; margin-top:12px">
          <button id="analyzeBtn" class="btn primary">Analyze</button>
          <button id="clearBtn" class="btn ghost">Clear</button>
        </div>

        <div style="margin-top:14px">
          <div style="font-weight:700;margin-bottom:6px">Quick prompts</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn ghost template" data-prompt="Summarize key insights in 3 bullets">Summary</button>
            <button class="btn ghost template" data-prompt="List top keywords and entities">Keywords</button>
            <button class="btn ghost template" data-prompt="Detect overall sentiment and tone">Sentiment</button>
          </div>
        </div>
      </section>

      <!-- RIGHT: Dashboard -->
      <section class="dashboard">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div style="font-weight:800;font-size:18px">Insights Dashboard</div>
            <div class="small">Interactive visualizations & cards — powered by in-browser analysis.</div>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <div class="kpi">
              <div class="kpi" style="display:flex;gap:8px">
                <div style="text-align:right">
                  <div class="small">Documents</div>
                  <div id="kDocs" class="num">0</div>
                </div>
                <div style="text-align:right">
                  <div class="small">Keywords</div>
                  <div id="kKeywords" class="num">0</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
          <div style="flex:1; min-width:320px">
            <div class="chart" id="keywordsChartWrap">
              <canvas id="keywordsChart"></canvas>
            </div>
          </div>

          <div style="width:340px">
            <div style="font-weight:700">Document Viewer</div>
            <div style="margin-top:8px" class="panel" id="docViewer">No document selected — click a file to view preview.</div>
            <div style="margin-top:8px; display:flex; gap:8px">
              <button id="prevBtn" class="btn ghost">Prev</button>
              <button id="nextBtn" class="btn ghost">Next</button>
              <button id="exportCSV" class="btn ghost">Export CSV</button>
            </div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Generated Insights</div>
            <div class="small" id="insCount">0 cards</div>
          </div>

          <div class="insights" id="insightsGrid" aria-live="polite" style="margin-top:12px"></div>
        </div>
      </section>
    </main>

    <footer class="pagefoot">Made with ❤️ — AI Insights Lab • Mock mode works fully offline in your browser.</footer>
  </div>

<script>
/* -------------------------------------------
   EPIC FRONTEND SCRIPT
   - click + drag uploader
   - pdf text extraction (pdf.js)
   - mock analysis (TF-IDF-like keywords + simple sentiment)
   - charts (Chart.js)
   - interactive UI interactions and animations
   -------------------------------------------*/

const fileInput = document.getElementById('fileInput');
const uploader = document.getElementById('uploader');
const fileList = document.getElementById('fileList');
const quickCount = document.getElementById('quickCount');
const analyzeBtn = document.getElementById('analyzeBtn');
const clearBtn = document.getElementById('clearBtn');
const insightsGrid = document.getElementById('insightsGrid');
const kDocs = document.getElementById('kDocs');
const kKeywords = document.getElementById('kKeywords');
const docViewer = document.getElementById('docViewer');
const insCount = document.getElementById('insCount');
const exportBtn = document.getElementById('exportBtn');
const exportCSV = document.getElementById('exportCSV');
const themeBtn = document.getElementById('themeBtn');
const modeSelect = document.getElementById('mode');

let DOCUMENTS = []; // {id,name,type,text}
let currentIndex = -1;
let keywordsChart = null;

/* Utilities */
function id(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8) }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'})[c]) }

/* PDF extraction using pdf.js */
async function extractPdfText(file){
  try{
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
    let txt = '';
    for(let i=1;i<=pdf.numPages;i++){
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const strings = content.items.map(it=>it.str);
      txt += strings.join(' ') + '\\n';
    }
    return txt;
  }catch(e){
    console.warn('PDF parse failed', e);
    return '';
  }
}

/* Handle files (click or drop) */
async function handleFiles(fileListObj){
  const list = Array.from(fileListObj).slice(0,8); // limit 8
  for(const f of list){
    try{
      let text = '';
      if(f.type === 'application/pdf' || f.name.toLowerCase().endsWith('.pdf')){
        text = await extractPdfText(f);
        if(!text) text = '(PDF plaintext could not be extracted)';
      } else {
        text = await f.text();
      }
      DOCUMENTS.push({ id: id(), name: f.name, type: f.type || 'text', text });
    }catch(err){
      console.warn('skip file', f.name, err);
    }
  }
  renderFileList();
  updateKPIs();
}

/* File list rendering */
function renderFileList(){
  fileList.innerHTML = '';
  DOCUMENTS.forEach((d, idx) => {
    const item = document.createElement('div');
    item.className = 'file-item';
    item.innerHTML = `
      <div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;font-weight:700">
        ${escapeHtml(d.name.split('.').pop().toUpperCase())}
      </div>
      <div class="file-meta">
        <div style="font-weight:600">${escapeHtml(d.name)}</div>
        <div class="small">${escapeHtml(d.text.slice(0,120).replace(/\\n/g,' '))}${d.text.length>120?'...':''}</div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn ghost" title="Preview" onclick="window.__preview(${idx})">Preview</button>
        <button class="btn ghost" title="Remove" onclick="window.__remove(${idx})">Remove</button>
      </div>
    `;
    fileList.appendChild(item);
  });
  quickCount.textContent = `${DOCUMENTS.length} files`;
}

/* preview and remove for global access (from inline onclicks) */
window.__preview = function(i){
  currentIndex = i;
  docViewer.innerText = DOCUMENTS[i].text.slice(0, 20000);
};
window.__remove = function(i){
  DOCUMENTS.splice(i,1);
  if(currentIndex === i) {
    docViewer.innerText = 'No document selected — click a file to view preview.';
    currentIndex = -1;
  }
  renderFileList();
  updateKPIs();
};

/* Drag & drop UX */
uploader.addEventListener('dragover', (e)=>{ e.preventDefault(); uploader.classList.add('dragover') });
uploader.addEventListener('dragleave', ()=>{ uploader.classList.remove('dragover') });
uploader.addEventListener('drop', (e)=>{ e.preventDefault(); uploader.classList.remove('dragover'); handleFiles(e.dataTransfer.files) });
fileInput.addEventListener('change', (e)=> handleFiles(e.target.files));

/* KPIs */
function updateKPIs(){
  kDocs.innerText = DOCUMENTS.length;
}

/* SIMPLE TEXT PROCESSING: tokenize, TF-like frequency */
function tokenize(s){
  return s.toLowerCase().replace(/[^a-z0-9\\s]/g,' ').split(/\\s+/).filter(Boolean).map(t=>t.trim()).filter(t=>t.length>2);
}

function topKeywords(docs, topN=10){
  const freq = {};
  docs.forEach(t=>{
    tokenize(t).forEach(w=>freq[w] = (freq[w]||0) + 1);
  });
  return Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,topN).map(x=>({k:x[0],v:x[1]}));
}

/* SENTIMENT (tiny lexicon) */
const SENT = { good:2, great:3, excellent:3, positive:2, happy:2, improve:1, improved:1, bad:-2, poor:-2, negative:-2, problem:-2, risk:-2, fail:-3 };

function sentimentScore(text){
  let s = 0;
  tokenize(text).forEach(w => { if(SENT[w]) s += SENT[w]; });
  return s;
}

/* CHART: render keywords bar chart */
function renderKeywordsChart(klist){
  const ctx = document.getElementById('keywordsChart').getContext('2d');
  const labels = klist.map(x=>x.k);
  const data = klist.map(x=>x.v);
  if(keywordsChart) {
    keywordsChart.data.labels = labels;
    keywordsChart.data.datasets[0].data = data;
    keywordsChart.update();
    return;
  }
  keywordsChart = new Chart(ctx, {
    type: 'bar',
    data: { labels, datasets: [{ label: 'Mentions', data, backgroundColor: Array.from({length:labels.length}).map((_,i)=>`rgba(124,58,237,${0.9 - i*0.08})`) }] },
    options: { responsive:true, plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
  });
}

/* ANALYZE (mock) */
function analyzeMock(prompt){
  const texts = DOCUMENTS.map(d=>d.text);
  const combined = texts.join('\\n') || 'No documents provided.';
  const kw = topKeywords(texts, 8);
  renderKeywordsChart(kw);
  kKeywords.innerText = kw.length;

  // simple insights
  const insights = [];
  insights.push({ title: 'Summary (mock)', text: combined.slice(0,600) + (combined.length>600 ? '...' : '') });
  insights.push({ title: 'Top keywords', text: kw.map(x=>x.k).join(', ') || 'N/A' });

  const senti = DOCUMENTS.map(d=> ({name:d.name,score: sentimentScore(d.text)} ));
  const sentiText = senti.map(s => `${s.name}: ${s.score >= 2 ? 'Positive' : s.score >= 0 ? 'Neutral' : 'Negative'} (${s.score})`).join('\\n');
  insights.push({ title: 'Sentiment (mock)', text: sentiText || 'No content' });
  insights.push({ title: 'Action items', text: '1) Monitor top keywords weekly\\n2) Review negative documents for issues\\n3) Run live summarization for deeper insights' });

  renderInsights(insights);
}

/* Render insights cards */
function renderInsights(items){
  insightsGrid.innerHTML = '';
  items.forEach(it=>{
    const card = document.createElement('div');
    card.className = 'insight-card';
    card.innerHTML = `<strong>${escapeHtml(it.title)}</strong><div class="small" style="margin-top:8px; white-space:pre-wrap">${escapeHtml(it.text)}</div>`;
    insightsGrid.appendChild(card);
  });
  insCount.innerText = items.length;
}

/* wired analyze button */
analyzeBtn.addEventListener('click', async ()=>{
  if(DOCUMENTS.length === 0){ alert('Please upload at least one document first.'); return; }
  if(modeSelect.value === 'live'){
    // live mode placeholder: since we are not requiring a server here, show a message and fallback to mock
    const proceed = confirm('Live mode requires a deployed proxy server. Click OK to attempt (frontend will try to POST), or Cancel to run mock analysis.');
    if(!proceed){ analyzeMock(); return; }
    // If user proceeds, try to POST to /analyze relative path (user may have deployed server elsewhere)
    try {
      const resp = await fetch('/analyze', {
        method:'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ documents: DOCUMENTS.map(d=>({name:d.name,text:d.text})), prompt: '' })
      });
      if(!resp.ok) throw new Error('Server error ' + resp.status);
      const json = await resp.json();
      if(json.chart && json.chart.labels){
        renderKeywordsChart(json.chart.labels.map((lab,i)=>({k: lab, v: json.chart.data[i] || 1})));
      }
      renderInsights(json.insights || []);
    } catch(err){
      console.warn('Live call failed', err);
      alert('Live analysis failed — falling back to mock. (See console for details.)');
      analyzeMock();
    }
  } else {
    analyzeMock(document.getElementById('prompt').value);
  }
});

/* CLEAR */
clearBtn.addEventListener('click', ()=> {
  if(!confirm('Clear all uploaded files and results?')) return;
  DOCUMENTS = []; currentIndex = -1; fileList.innerHTML=''; quickCount.innerText='0 files'; docViewer.innerText='No document selected — click a file to view preview.'; insightsGrid.innerHTML=''; if(keywordsChart){ keywordsChart.data.labels = []; keywordsChart.data.datasets[0].data = []; keywordsChart.update(); } kDocs.innerText='0'; kKeywords.innerText='0'; insCount.innerText='0';
});

/* EXPORT JSON REPORT */
exportBtn.addEventListener('click', ()=>{
  const payload = { meta: {ts: (new Date()).toISOString()}, docs: DOCUMENTS, insights: Array.from(document.querySelectorAll('.insight-card')).map(n=>({title:n.querySelector('strong').innerText, text:n.querySelector('.small').innerText})) };
  const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'ai-insights-report.json'; a.click();
});

/* EXPORT CSV of docs */
exportCSV.addEventListener('click', ()=>{
  if(DOCUMENTS.length === 0){ alert('No documents to export.'); return; }
  const rows = [['name','text']];
  DOCUMENTS.forEach(d => rows.push([d.name, d.text.replace(/\\n/g,' ').slice(0,200)]));
  const csv = rows.map(r => `\"${r[0].replace(/\"/g,'\"\"')}\",\"${r[1].replace(/\"/g,'\"\"')}\"`).join('\\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'documents.csv'; a.click();
});

/* TEMPLATE BUTTONS */
document.querySelectorAll('.template').forEach(btn => btn.addEventListener('click', (e)=>{
  const p = e.currentTarget.getAttribute('data-prompt') || '';
  // insert prompt into a quick inlined prompt input area — we will reuse analyze button only, so show a prompt modal via alert (brief)
  if(confirm('Set prompt to: \"' + p + '\" and run analysis?')) {
    analyzeMock(p);
  }
}));

/* THEME toggle (light / dark) */
themeBtn.addEventListener('click', ()=>{
  if(document.documentElement.style.getPropertyValue('--light') === '1'){
    // switch to dark
    document.documentElement.style.removeProperty('--light');
    document.body.style.background = 'radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent), radial-gradient(900px 400px at 90% 85%, rgba(52,211,153,0.06), transparent), linear-gradient(180deg,#071122,#071b2c)';
    themeBtn.innerText = 'Theme';
  } else {
    // light theme
    document.documentElement.style.setProperty('--light','1');
    document.body.style.background = 'linear-gradient(180deg,#f7fafc,#e6eef8)';
    document.body.style.color = '#091024';
    themeBtn.innerText = 'Dark';
  }
});

/* initial tiny demo populate (sample doc) */
(function seedDemo(){
  const exampleText = `AI Insights Lab — Demo document.
This is a short demo document used to show the UI. It mentions AI, insights, analysis, and dashboards.
Use the upload area to add more files.`;
  DOCUMENTS.push({ id:id(), name:'demo-note.txt', type:'text', text: exampleText });
  renderFileList();
  updateKPIs();
})();

/* update UI KPIs */
function updateKPIs(){
  kDocs.innerText = DOCUMENTS.length;
}

/* helper: update after adding files */
function renderFileList(){ /* redefined earlier so ensure it's the one used */; }
renderFileList = renderFileList || (()=>{}); // guard

// Re-assign the renderFileList reference to the real function if missing (ensures seed works)
if(typeof renderFileList !== 'function' || renderFileList.toString().indexOf('fileList') === -1){
  // the actual function defined earlier has proper behavior; re-define simple fallback
  renderFileList = function(){
    fileList.innerHTML = '';
    DOCUMENTS.forEach((d, idx) => {
      const item = document.createElement('div');
      item.className = 'file-item';
      item.innerHTML = `<div style="width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">${escapeHtml(d.name.split('.').pop().toUpperCase())}</div>
      <div class="file-meta"><div style="font-weight:600">${escapeHtml(d.name)}</div><div class="small">${escapeHtml(d.text.slice(0,120).replace(/\\n/g,' '))}${d.text.length>120?'...':''}</div></div>
      <div style="display:flex;gap:8px"><button class="btn ghost" onclick="window.__preview(${idx})">Preview</button><button class="btn ghost" onclick="window.__remove(${idx})">Remove</button></div>`;
      fileList.appendChild(item);
    });
    quickCount.textContent = `${DOCUMENTS.length} files`;
  };
  renderFileList();
}

/* ensure charts initial empty state */
renderKeywordsChart([]);

</script>
</body>
</html>
